(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[391],{7588:function(e,t,r){Promise.resolve().then(r.bind(r,7814))},7814:function(e,t,r){"use strict";r.r(t),r.d(t,{DataContext:function(){return b},default:function(){return S}});var n=r(7437),i=r(2265),o=r(7776),s=r(3830),a=r(2808),l=r(5225),c=r(8960),u=r(8684),d=r(3092);function h(){let e=(0,i.useRef)(),t=(0,i.useRef)(),r=(0,i.useContext)(b),[h,f]=r.active,[x,p]=r.bulletInfo,[m,y]=r.monkeyInfo,[v,g]=r.cameraPos,[w,M]=r.graphType,j=r.init[1],P=r.showTrail[1],S=r.showGrid[1],[C,E]=r.graphData,[z,V]=r.hit,k=r.initialMonkeyPos,{showGraph:R}=(0,i.useContext)(d.ShowUIContext);return(0,i.useEffect)(()=>{if(z)return;let e=new o.Vector3().copy(x.position);e.sub(m.position),V(1>=e.length())},[m,x]),(0,n.jsxs)("div",{children:[(0,n.jsx)(u.Z,{initialPos:{x:10,y:50},children:(0,n.jsxs)("div",{style:{width:"200px",background:"#fff",display:"inline-block"},className:"p-2",children:[(0,n.jsxs)(s.Z,{children:[(0,n.jsxs)(s.Z.Group,{children:[(0,n.jsx)(s.Z.Label,{children:"初期速度"}),(0,n.jsx)(c.Z,{min:30,max:150,step:1,defaultValue:50,ref:e})]}),(0,n.jsxs)(s.Z.Group,{children:[(0,n.jsx)(s.Z.Label,{children:"グラフタイプ"}),(0,n.jsxs)(s.Z.Select,{onChange:e=>{M(+e.target.value)},children:[(0,n.jsx)("option",{value:-1,children:"なし"}),(0,n.jsx)("option",{value:0,children:"y-t"}),(0,n.jsx)("option",{value:1,children:"Vy-t"})]})]}),(0,n.jsx)(s.Z.Check,{ref:t,type:"switch",label:"軌跡を表示",defaultChecked:!0}),(0,n.jsx)(s.Z.Check,{type:"switch",label:"XYグリッドを表示",onChange:e=>{S(e.target.checked)}})]}),(0,n.jsx)(a.Z,{variant:"primary",onClick:()=>{P(t.current.checked),j(!0),E([]),y({position:k.clone(),velocity:new o.Vector3});let r=+e.current.value,n=Math.atan(k.y/k.x);p({position:new o.Vector3,velocity:new o.Vector3(Math.cos(n),Math.sin(n),0).multiplyScalar(r)}),V(!1)},children:"適用"}),(0,n.jsx)(a.Z,{variant:"primary",onClick:e=>{f(!h),"再生"===e.target.innerHTML?e.target.innerHTML="一時停止":e.target.innerHTML="再生"},children:"再生"})]})}),R&&(0,n.jsx)(u.Z,{initialPos:{x:220,y:50},children:(e=>{switch(e){case 0:return(0,n.jsx)(l.Z,{position:{x:0,y:630},title:"y-tグラフ",size:{width:250,height:250},data:{x:C.map(e=>e.t),y:C.map(e=>e.data.position.y),x_range:{min:0,max:30},y_range:{min:0,max:4*v.y}},drawLine:!0});case 1:return(0,n.jsx)(l.Z,{position:{x:0,y:630},title:"Vy-tグラフ",size:{width:250,height:250},data:{x:C.map(e=>e.t),y:C.map(e=>e.data.velocity.y),x_range:{min:0,max:30},y_range:{min:-10*Math.sqrt(10*v.y*4)/7,max:10*Math.sqrt(10*v.y*4)/7}},drawLine:!0});default:return null}})(w)})]})}var f=r(8842),x=r(2238),p=r(4823);function m(e){let{pos:t,velocity:r,radius:s,color:a,onChange:l,show_trail:c=!1,trail_cooltime:u=.2,renderGraph:d=!1,updateGraph:h=()=>{},active:m=!0,init:y={init:!1,setInit:()=>{}}}=e,v=(0,i.useRef)(r.y),[g,w]=(0,i.useState)([]),M=(0,i.useRef)(),j=(0,i.useRef)(0),P=(0,i.useRef)(0);return(0,i.useEffect)(()=>{v.current=r.y},[t,r]),(0,i.useEffect)(()=>{w([]),j.current=0,y.setInit(!1)},[y.init]),(0,f.C)((e,t)=>{if(!(m&&t<.1&&M.current.position.y>=0))return;v.current+=-9.8*t;let n=M.current;n.position.x+=r.x*t,n.position.y+=v.current*t,n.position.z+=r.z*t,P.current>=u&&(c&&w([...g,M.current.position.clone()]),d&&h(j.current,{position:n.position.clone(),velocity:new o.Vector3(r.x,v.current,r.z)}),P.current-=u),j.current+=t,P.current+=t,l({position:n.position,velocity:new o.Vector3(r.x,v.current,r.z)})}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.aL,{position:[t.x,t.y,t.z],castShadow:!0,ref:M,args:[s,32,32],children:(0,n.jsx)("meshPhysicalMaterial",{color:a,metalness:.5,roughness:0})}),(0,n.jsx)(x.Z,{radius:s,color:a,pos:g})]})}var y=r(6277),v=r(2325);function g(e){let{pos:t,onChange:r,graphUpdateTime:s,renderGraph:a=!1,updateGraph:l=()=>{},active:c=!0,init:u={init:!1,setInit:()=>{}},hit:d=!1}=e,h=(0,i.useRef)(),x=(0,i.useRef)(0),m=(0,i.useRef)(0),y=(0,i.useRef)(new o.Vector3);(0,i.useEffect)(()=>{x.current=0,y.current=new o.Vector3},[u.init]),(0,f.C)((e,t)=>{if(!(c&&t<.1&&h.current.position.y>=0))return;y.current.y+=-9.8*t;let n=h.current,i=y.current;n.position.x+=i.x*t,n.position.y+=i.y*t,n.position.z+=i.z*t;let u=new o.Vector3(i.x,i.y,i.z);a&&m.current>=s&&(l(x.current,{position:n.position.clone(),velocity:u}),m.current-=s),x.current+=t,m.current+=t,r({position:n.position,velocity:u})});let g="サル";return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.V,{position:[t.x,t.y,t.z],style:{color:d?"#f00":"#fff",width:"max-content",fontSize:"250%",marginLeft:"-".concat(g.length/2,"em"),marginTop:"-2.5em",textAlign:"center"},children:g}),(0,n.jsx)(p.xu,{position:[t.x,t.y,t.z],castShadow:!0,ref:h,args:[5,5,5],children:(0,n.jsx)("meshPhysicalMaterial",{color:9523997,metalness:.5,roughness:0})})]})}var w=r(8915);function M(){let e=(0,i.useContext)(b),t=e.active[0],[r,s]=e.bulletInfo,[a,l]=e.monkeyInfo,c=e.cameraPos[0],[u,d]=e.init,h=e.showTrail,f=e.showGrid,[x,p]=e.graphData,[v,M]=e.hit;return(0,n.jsxs)(y.Z,{showGrid:f,children:[(0,n.jsx)(y.N,{camera_pos:c,camera_lookAt:new o.Vector3(c.x,c.y,0)}),(0,n.jsx)(m,{pos:r.position,velocity:r.velocity,radius:w.px,color:w.SQ,showTrail:h,trail_cooltime:w.Xd,onChange:s,renderGraph:!0,updateGraph:(e,t)=>{p([...x,{t:e,data:t}])},active:t,init:{init:u,setInit:d}}),(0,n.jsx)(g,{pos:a.position,onChange:l,active:t,init:{init:u,setInit:d},hit:v})]})}var j=r(8318);let P=new o.Vector3(80,50,0),b=(0,i.createContext)(null);function S(){let e=Math.atan(5/8),[t,r]=(0,i.useState)(!1),[s,a]=(0,i.useState)({position:new o.Vector3,velocity:new o.Vector3(Math.cos(e),Math.sin(e),0).multiplyScalar(50)}),[l,c]=(0,i.useState)({position:P.clone(),velocity:new o.Vector3}),[u,d]=(0,i.useState)({x:l.position.x/2,y:l.position.y/2,z:1.75*l.position.y}),[f,x]=(0,i.useState)(0),[p,m]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!0),[g,w]=(0,i.useState)(!1),[S,C]=(0,i.useState)([]),[E,z]=(0,i.useState)(!1);return(0,n.jsx)(b.Provider,{value:{cameraPos:[u,d],graphType:[f,x],graphData:[S,C],init:[p,m],showTrail:[y,v],showGrid:[g,w],active:[t,r],bulletInfo:[s,a],monkeyInfo:[l,c],hit:[E,z],initialMonkeyPos:P},children:(0,n.jsx)(j.Z,{top:(0,n.jsx)(h,{}),bottom:(0,n.jsx)(M,{})})})}},2325:function(e,t,r){"use strict";let n,i;r.d(t,{V:function(){return g}});var o=r(2988),s=r(2265),a=r(4040),l=r(7776),c=r(8842);let u=new l.Vector3,d=new l.Vector3,h=new l.Vector3,f=new l.Vector2;function x(e,t,r){let n=u.setFromMatrixPosition(e.matrixWorld);n.project(t);let i=r.width/2,o=r.height/2;return[n.x*i+i,-(n.y*o)+o]}let p=e=>1e-10>Math.abs(e)?0:e;function m(e,t,r=""){let n="matrix3d(";for(let r=0;16!==r;r++)n+=p(t[r]*e.elements[r])+(15!==r?",":")");return r+n}let y=(n=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>m(e,n)),v=(i=e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1],(e,t)=>m(e,i(t),"translate(-50%,-50%)")),g=s.forwardRef(({children:e,eps:t=.001,style:r,className:n,prepend:i,center:m,fullscreen:g,portal:w,distanceFactor:M,sprite:j=!1,transform:P=!1,occlude:b,onOcclude:S,castShadow:C,receiveShadow:E,material:z,geometry:V,zIndexRange:k=[16777271,0],calculatePosition:R=x,as:W="div",wrapperClass:Z,pointerEvents:T="auto",...I},$)=>{let{gl:_,camera:L,scene:F,size:A,raycaster:N,events:G,viewport:H}=(0,c.A)(),[D]=s.useState(()=>document.createElement(W)),O=s.useRef(),q=s.useRef(null),X=s.useRef(0),Q=s.useRef([0,0]),U=s.useRef(null),Y=s.useRef(null),B=(null==w?void 0:w.current)||G.connected||_.domElement.parentNode,J=s.useRef(null),K=s.useRef(!1),ee=s.useMemo(()=>{var e;return b&&"blending"!==b||Array.isArray(b)&&b.length&&(e=b[0])&&"object"==typeof e&&"current"in e},[b]);s.useLayoutEffect(()=>{let e=_.domElement;b&&"blending"===b?(e.style.zIndex=`${Math.floor(k[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[b]),s.useLayoutEffect(()=>{if(q.current){let e=O.current=a.createRoot(D);if(F.updateMatrixWorld(),P)D.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{let e=R(q.current,L,A);D.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return B&&(i?B.prepend(D):B.appendChild(D)),()=>{B&&B.removeChild(D),e.unmount()}}},[B,P]),s.useLayoutEffect(()=>{Z&&(D.className=Z)},[Z]);let et=s.useMemo(()=>P?{position:"absolute",top:0,left:0,width:A.width,height:A.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:m?"translate3d(-50%,-50%,0)":"none",...g&&{top:-A.height/2,left:-A.width/2,width:A.width,height:A.height},...r},[r,m,g,A,P]),er=s.useMemo(()=>({position:"absolute",pointerEvents:T}),[T]);s.useLayoutEffect(()=>{var t,i;K.current=!1,P?null==(t=O.current)||t.render(s.createElement("div",{ref:U,style:et},s.createElement("div",{ref:Y,style:er},s.createElement("div",{ref:$,className:n,style:r,children:e})))):null==(i=O.current)||i.render(s.createElement("div",{ref:$,style:et,className:n,children:e}))});let en=s.useRef(!0);(0,c.C)(e=>{if(q.current){L.updateMatrixWorld(),q.current.updateWorldMatrix(!0,!1);let e=P?Q.current:R(q.current,L,A);if(P||Math.abs(X.current-L.zoom)>t||Math.abs(Q.current[0]-e[0])>t||Math.abs(Q.current[1]-e[1])>t){let t=function(e,t){let r=u.setFromMatrixPosition(e.matrixWorld),n=d.setFromMatrixPosition(t.matrixWorld),i=r.sub(n),o=t.getWorldDirection(h);return i.angleTo(o)>Math.PI/2}(q.current,L),r=!1;ee&&(Array.isArray(b)?r=b.map(e=>e.current):"blending"!==b&&(r=[F]));let n=en.current;if(r){let e=function(e,t,r,n){let i=u.setFromMatrixPosition(e.matrixWorld),o=i.clone();o.project(t),f.set(o.x,o.y),r.setFromCamera(f,t);let s=r.intersectObjects(n,!0);if(s.length){let e=s[0].distance;return i.distanceTo(r.ray.origin)<e}return!0}(q.current,L,N,r);en.current=e&&!t}else en.current=!t;n!==en.current&&(S?S(!en.current):D.style.display=en.current?"block":"none");let i=Math.floor(k[0]/2),o=b?ee?[k[0],i]:[i-1,0]:k;if(D.style.zIndex=`${function(e,t,r){if(t instanceof l.PerspectiveCamera||t instanceof l.OrthographicCamera){let n=u.setFromMatrixPosition(e.matrixWorld),i=d.setFromMatrixPosition(t.matrixWorld),o=n.distanceTo(i),s=(r[1]-r[0])/(t.far-t.near),a=r[1]-s*t.far;return Math.round(s*o+a)}}(q.current,L,o)}`,P){let[e,t]=[A.width/2,A.height/2],r=L.projectionMatrix.elements[5]*t,{isOrthographicCamera:n,top:i,left:o,bottom:s,right:a}=L,l=y(L.matrixWorldInverse),c=n?`scale(${r})translate(${p(-(a+o)/2)}px,${p((i+s)/2)}px)`:`translateZ(${r}px)`,u=q.current.matrixWorld;j&&((u=L.matrixWorldInverse.clone().transpose().copyPosition(u).scale(q.current.scale)).elements[3]=u.elements[7]=u.elements[11]=0,u.elements[15]=1),D.style.width=A.width+"px",D.style.height=A.height+"px",D.style.perspective=n?"":`${r}px`,U.current&&Y.current&&(U.current.style.transform=`${c}${l}translate(${e}px,${t}px)`,Y.current.style.transform=v(u,1/((M||10)/400)))}else{let t=void 0===M?1:function(e,t){if(t instanceof l.OrthographicCamera)return t.zoom;if(!(t instanceof l.PerspectiveCamera))return 1;{let r=u.setFromMatrixPosition(e.matrixWorld),n=d.setFromMatrixPosition(t.matrixWorld);return 1/(2*Math.tan(t.fov*Math.PI/180/2)*r.distanceTo(n))}}(q.current,L)*M;D.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}Q.current=e,X.current=L.zoom}}if(!ee&&J.current&&!K.current){if(P){if(U.current){let e=U.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){let{isOrthographicCamera:t}=L;if(t||V)I.scale&&(Array.isArray(I.scale)?I.scale instanceof l.Vector3?J.current.scale.copy(I.scale.clone().divideScalar(1)):J.current.scale.set(1/I.scale[0],1/I.scale[1],1/I.scale[2]):J.current.scale.setScalar(1/I.scale));else{let t=(M||10)/400,r=e.clientWidth*t,n=e.clientHeight*t;J.current.scale.set(r,n,1)}K.current=!0}}}else{let t=D.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){let e=1/H.factor,r=t.clientWidth*e,n=t.clientHeight*e;J.current.scale.set(r,n,1),K.current=!0}J.current.lookAt(e.camera.position)}}});let ei=s.useMemo(()=>({vertexShader:P?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[P]);return s.createElement("group",(0,o.Z)({},I,{ref:q}),b&&!ee&&s.createElement("mesh",{castShadow:C,receiveShadow:E,ref:J},V||s.createElement("planeGeometry",null),z||s.createElement("shaderMaterial",{side:l.DoubleSide,vertexShader:ei.vertexShader,fragmentShader:ei.fragmentShader})))})}},function(e){e.O(0,[355,114,689,881,420,602,817,971,23,744],function(){return e(e.s=7588)}),_N_E=e.O()}]);